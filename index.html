<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>نقشه مسیر نماز</title>
<style>
  :root{--bg:#0b1f0b; --card:#09200d; --accent:#a4ff00; --muted:#9aa4b2;}
  *{box-sizing:border-box;font-family: Vazirmatn, 'Helvetica Neue', Arial, sans-serif;}
  body{margin:0;background:var(--bg);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
  .wrap{width:100%;max-width:1200px;background:rgba(0,0,0,0.1);border-radius:16px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,0.7);}
  header{display:flex;gap:12px;align-items:center;margin-bottom:16px;}
  header img{width:56px;height:56px;border-radius:10px;object-fit:cover;border:2px solid rgba(255,255,255,0.1);}
  h1{font-size:20px;margin:0;}
  p.lead{margin:0;color:var(--muted);font-size:13px;}

  .controls{display:flex;gap:10px;flex-wrap:wrap;margin:14px 0;}
  .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:12px;display:flex;gap:10px;align-items:center;}
  .card input[type=text]{background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:inherit;}
  .card input[type=file]{color:var(--muted);}
  .btn{background:var(--accent);color:#09200d;padding:8px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);}

  /* Path */
  .stage{margin-top:22px;padding:18px;background:rgba(0,0,0,0.05);border-radius:12px;overflow:auto;position:relative;height:500px;}
  .path-svg{width:100%;height:100%;}
  .node{position:absolute;width:60px;height:60px;border-radius:999px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform 0.3s;}
  .node .dot{width:48px;height:48px;border-radius:999px;background:rgba(164,255,0,0.3);display:flex;align-items:center;justify-content:center;font-weight:700;color:#09200d;transition:all 0.3s;}
  .node.checked .dot{background:var(--accent);color:#09200d;transform:scale(1.2);}
  .check-svg{width:40px;height:40px;position:absolute;pointer-events:none;opacity:0;transition:all 0.4s;}
  .node.checked .check-svg{opacity:1;transform:scale(1.1);}

  footer{margin-top:20px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
  .prize{display:flex;align-items:center;gap:12px;}
  .prize img{width:56px;height:56px;border-radius:10px;object-fit:cover;}
  .small{font-size:13px;color:var(--muted);}
</style>
</head>
<body>
<div class="wrap">
<header>
<img id="logoPreview" src="" alt="آرم">
<div>
<h1>نقشهٔ مسیر نماز — تیک بزن و جایزه بگیر 🎉</h1>
<p class="lead">روی هر دایره کلیک کن تا تیک بخوره. یا دکمه «نماز خواندم» رو بزن تا مرحلهٔ بعدی تیک بخوره.</p>
</div>
</header>
<div class="controls">
<div class="card">
<label class="small" style="margin-right:8px">نام جایزه:</label>
<input id="prizeName" type="text" placeholder="مثلاً: جایزه آخر هفته" />
</div>
<div class="card">
<label class="small" style="margin-right:8px">آپلود آرم:</label>
<input id="logoFile" type="file" accept="image/*" />
</div>
<div class="card">
<label class="small" style="margin-right:8px">تعداد مراحل:</label>
<input id="stepsCount" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="مثلاً: 7" style="width:56px" />
<button id="applySteps" class="btn ghost">اعمال</button>
</div>
<div style="margin-left:auto;display:flex;gap:8px">
<button id="prayBtn" class="btn">نماز خواندم 🙏</button>
<button id="resetBtn" class="btn ghost">بازنشانی</button>
</div>
</div>
<section class="stage">
<svg class="path-svg" id="pathSVG"></svg>
</section>
<footer>
<div class="prize">
<img id="prizeLogo" src="" alt="لوگو جایزه" onerror="this.style.display='none'"/>
<div>
<div id="prizeLabel" style="font-weight:700">جایزهٔ آخر مسیر</div>
<div class="small">وقتی همه تیک خورد، جایزه رو بگیر 🎁</div>
</div>
</div>
<div class="small">وضعیت ذخیره می‌شود در مرورگر شما</div>
</footer>
</div>
<script>
const DEFAULT_STEPS = 7;
const stateKey = 'namaz_path_state_v3';
let state = JSON.parse(localStorage.getItem(stateKey)||JSON.stringify({steps:DEFAULT_STEPS,checked:Array(DEFAULT_STEPS).fill(false),prizeName:'جایزهٔ آخر مسیر',logoData:''}));

const stage = document.querySelector('.stage');
const pathSVG = document.getElementById('pathSVG');
const prizeNameInput = document.getElementById('prizeName');
const logoFile = document.getElementById('logoFile');
const prizeLogo = document.getElementById('prizeLogo');
const logoPreview = document.getElementById('logoPreview');
const prizeLabel = document.getElementById('prizeLabel');
const prayBtn = document.getElementById('prayBtn');
const resetBtn = document.getElementById('resetBtn');
const stepsCountInput = document.getElementById('stepsCount');
const applySteps = document.getElementById('applySteps');

function saveState(){localStorage.setItem(stateKey,JSON.stringify(state));}

function generatePath(){
  pathSVG.innerHTML='';
  const w = stage.clientWidth, h=stage.clientHeight;
  const radius = 40;
  let points = [];
  for(let i=0;i<state.steps;i++){
    let x = 50 + 400*Math.sin(i/2);
    let y = 50 + i*60;
    points.push({x,y});
  }
  // Draw path
  let d='';
  points.forEach((p,i)=>{d+=i===0?`M${p.x},${p.y}`:` L${p.x},${p.y}`});
  const pathEl = document.createElementNS('http://www.w3.org/2000/svg','path');
  pathEl.setAttribute('d',d);
  pathEl.setAttribute('stroke','lime');
  pathEl.setAttribute('stroke-width','6');
  pathEl.setAttribute('fill','none');
  pathSVG.appendChild(pathEl);

  // Add nodes
  points.forEach((p,i)=>{
    let node = document.createElement('div');
    node.className='node'+(state.checked[i]?' checked':'');
    node.style.left=(p.x-30)+'px';
    node.style.top=(p.y-30)+'px';
    let dot = document.createElement('div');
    dot.className='dot'; dot.textContent=i+1;
    node.appendChild(dot);
    let svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
    svg.setAttribute('viewBox','0 0 24 24');
    svg.classList.add('check-svg');
    let path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d','M20 6L9 17l-5-5'); path.setAttribute('fill','none'); path.setAttribute('stroke','#09200d'); path.setAttribute('stroke-width','3'); path.setAttribute('stroke-linecap','round'); path.setAttribute('stroke-linejoin','round');
    svg.appendChild(path);
    node.appendChild(svg);
    node.addEventListener('click',()=>{state.checked[i]=!state.checked[i];renderNodes();});
    stage.appendChild(node);
  });
}

function renderNodes(){
  const nodes = document.querySelectorAll('.node');
  nodes.forEach((n,i)=>{
    n.classList.toggle('checked',state.checked[i]);
  });
  prizeLabel.textContent = state.prizeName;
  if(state.logoData){prizeLogo.src=state.logoData;logoPreview.src=state.logoData;prizeLogo.style.display='block';}else{prizeLogo.style.display='none';}
  saveState();
}

prayBtn.addEventListener('click',()=>{
  const next = state.checked.indexOf(false);
  if(next>-1){state.checked[next]=true;renderNodes();}
});
resetBtn.addEventListener('click',()=>{
  state.checked=Array(state.steps).fill(false);renderNodes();
});
prizeNameInput.addEventListener('input',(e)=>{state.prizeName=e.target.value;renderNodes();});
logoFile.addEventListener('change',e=>{
  const f = e.target.files[0];if(!f)return;
  const reader = new FileReader();reader.onload=()=>{state.logoData=reader.result;renderNodes();};reader.readAsDataURL(f);
});
applySteps.addEventListener('click',()=>{
  const n = parseInt(stepsCountInput.value)||7;
  state.steps=n;state.checked=Array(n).fill(false);generatePath();renderNodes();
});
stepsCountInput.value=state.steps;
generatePath();
renderNodes();
</script>
</body>
</html>
